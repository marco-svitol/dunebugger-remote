version: '3.8'

services:
  dunebugger-remote:
    image: dunebugger-remote:arm64
    platform: linux/arm64  
    container_name: dunebugger-remote
    restart: unless-stopped
    environment:
      - PYTHONPATH=/app
    volumes:
      # Mount config directory for easy configuration updates
      - /etc/dunebugger-remote/config:/app/app/config:ro
    networks:
      - dunebugger-network
    depends_on:
      - nats-server

  # NATS server for message queue (based on your config)
  nats-server:
    image: nats:latest
    platform: linux/arm64
    container_name: nats-server
    restart: unless-stopped
    ports:
      - "4222:4222"
      - "8222:8222"  # HTTP monitoring port
    networks:
      - dunebugger-network
    # NATS server command with monitoring and debug/verbose flags
    command: ["-m", "8222", "-DV"]

# Create a custom network that other containers can join
networks:
  dunebugger-network:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 172.20.0.0/16