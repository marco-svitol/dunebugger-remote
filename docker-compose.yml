version: '3.8'
services:
  dunebugger-remote:
    image: ilciclaio/dunebugger-remote:latest
    container_name: dunebugger-remote
    restart: unless-stopped
    network_mode: host  # Use host networking to access Raspberry Pi interfaces
    env_file:
      - .env
    environment:
      - PYTHONPATH=/app
    volumes:
      # Mount config directory for easy configuration updates
      - /opt/dunebugger-remote/config:/app/app/config:rw
      # Mount host proc and sys for network information
      - /proc:/host/proc:ro
      - /sys:/host/sys:ro
      # Mount the host’s timezone data
      - /etc/localtime:/etc/localtime:ro
      - /etc/timezone:/etc/timezone:ro
    depends_on:
      - nats-server

  dunebugger-scheduler:
    image: ilciclaio/dunebugger-scheduler:latest
    container_name: dunebugger-scheduler
    restart: unless-stopped
    network_mode: host  # Use host networking to access Raspberry Pi interfaces
    environment:
      - PYTHONPATH=/app
    volumes:
      # Mount config directory for easy configuration updates
      - /opt/dunebugger-scheduler/config:/app/app/config:rw
      # Mount host proc and sys for network information
      - /proc:/host/proc:ro
      - /sys:/host/sys:ro
      # Mount the host’s timezone data
      - /etc/localtime:/etc/localtime:ro
      - /etc/timezone:/etc/timezone:ro
    depends_on:
      - dunebugger-remote

  # NATS server for message queue (based on your config)
  nats-server:
    image: nats:latest
    container_name: nats-server
    restart: unless-stopped
    network_mode: host  # Use host networking to match dunebugger-remote
    # Note: ports are not needed with host networking - they're directly exposed
    # NATS server command with monitoring and debug/verbose flags
    command: ["-m", "8222", "-DV"]